<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Details - EventHub</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <h1>EventHub</h1>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="announcements.html">Announcements</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="profile.html" class="profile-link">Profile</a></li>
            <li><a href="#" class="login-btn" id="auth-btn">Login</a></li>
        </ul>
        <div class="burger">
            <div class="line1"></div>
            <div class="line2"></div>
            <div class="line3"></div>
        </div>
    </nav>

    <section class="event-details-container">
        <div class="event-header">
            <h1 id="event-title">Event Title</h1>
            <div class="event-meta">
                <span id="event-date"><i class="far fa-calendar-alt"></i> Date: </span>
                <span id="event-time"><i class="far fa-clock"></i> Time: </span>
                <span id="event-location"><i class="fas fa-map-marker-alt"></i> Location: </span>
                <span id="event-category"><i class="fas fa-tag"></i> Category: </span>
            </div>
        </div>

        <div class="event-content">
            <div class="event-image">
                <img id="event-img" src="images/default-event.jpg" alt="Event image">
            </div>
            <div class="event-info">
                <h3>About this event</h3>
                <p id="event-description"></p>
                
                <div class="attendance-info">
                    <p><span id="attendee-count">0</span> people are attending this event</p>
                    <p><span id="spots-left">0</span> spots left</p>
                </div>

                <div class="action-buttons">
                    <button id="rsvp-btn" class="btn-primary">RSVP for this event</button>
                    <button id="feedback-btn" class="btn-secondary">View/Add Feedback</button>
                    <button id="edit-event-btn" class="btn-secondary handler-only">Edit Event</button>
                    <button id="delete-event-btn" class="btn-danger handler-only">Delete Event</button>
                </div>
            </div>
        </div>

        <div class="attendees-section">
            <h3>Attendees</h3>
            <ul id="attendees-list" class="attendees-list">
                <!-- Attendees will be populated here -->
            </ul>
        </div>
    </section>

    <footer>
        <div class="footer-content">
            <div class="footer-section about">
                <h2>EventHub</h2>
                <p>Your one-stop platform for creating, managing, and discovering amazing events.</p>
                <div class="contact">
                    <span><i class="fas fa-envelope"></i> contact@eventhub.com</span>
                </div>
                <div class="socials">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-section links">
                <h2>Quick Links</h2>
                <ul>
                    <li><a href="events.html">Events</a></li>
                    <li><a href="announcements.html">Announcements</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="feedback.html">Feedback</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 EventHub | All rights reserved
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check login status and update navigation
            const userEmail = localStorage.getItem('userEmail');
            const userRole = localStorage.getItem('userRole');
            const authBtn = document.getElementById('auth-btn');
            
            if (userEmail) {
                authBtn.textContent = 'Logout';
                authBtn.classList.remove('login-btn');
                authBtn.classList.add('logout-btn');
            } else {
                authBtn.textContent = 'Login';
                authBtn.classList.remove('logout-btn');
                authBtn.classList.add('login-btn');
            }

            // Handle auth button click
            authBtn.addEventListener('click', function() {
                if (userEmail) {
                    // Logout
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('userRole');
                    window.location.href = 'index.html';
                } else {
                    // Go to login
                    window.location.href = 'login.html';
                }
            });

            // Get the event ID from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const eventId = parseInt(urlParams.get('id'));
            
            if (!eventId) {
                alert('Event not found!');
                window.location.href = 'events.html';
                return;
            }

            // Load event data from localStorage
            const events = JSON.parse(localStorage.getItem('events')) || [];
            const event = events.find(e => e.id === eventId);
            
            if (!event) {
                alert('Event not found!');
                window.location.href = 'events.html';
                return;
            }

            // Populate event details
            document.getElementById('event-title').textContent = event.title;
            document.getElementById('event-date').innerHTML += formatDate(event.date);
            document.getElementById('event-time').innerHTML += event.time;
            document.getElementById('event-location').innerHTML += event.location;
            document.getElementById('event-category').innerHTML += capitalizeFirstLetter(event.category);
            document.getElementById('event-description').textContent = event.description;
            document.getElementById('event-img').src = event.image || 'images/default-event.jpg';
            document.getElementById('event-img').alt = event.title;
            
            // Show attendees count and spots left
            const attendeeCount = event.attendees ? event.attendees.length : 0;
            document.getElementById('attendee-count').textContent = attendeeCount;
            document.getElementById('spots-left').textContent = event.capacity - attendeeCount;
            
            // Show or hide handler-only controls
            const handlerControls = document.querySelectorAll('.handler-only');
            if (userRole === 'handler' && event.createdBy === userEmail) {
                handlerControls.forEach(control => {
                    control.style.display = 'inline-block';
                });
            } else {
                handlerControls.forEach(control => {
                    control.style.display = 'none';
                });
            }
            
            // Populate attendees list
            const attendeesList = document.getElementById('attendees-list');
            if (event.attendees && event.attendees.length > 0) {
                event.attendees.forEach(attendee => {
                    const li = document.createElement('li');
                    li.textContent = attendee;
                    attendeesList.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'No attendees yet';
                attendeesList.appendChild(li);
            }
            
            // RSVP Button functionality
            const rsvpBtn = document.getElementById('rsvp-btn');
            rsvpBtn.addEventListener('click', function() {
                if (!userEmail) {
                    alert('Please login to RSVP for events');
                    window.location.href = 'login.html';
                    return;
                }
                
                if (event.attendees && event.attendees.includes(userEmail)) {
                    // User is already attending, allow cancellation
                    event.attendees = event.attendees.filter(email => email !== userEmail);
                    rsvpBtn.textContent = 'RSVP for this event';
                    alert('You have cancelled your RSVP.');
                } else {
                    // Add user to attendees
                    if (!event.attendees) {
                        event.attendees = [];
                    }
                    if (event.attendees.length >= event.capacity) {
                        alert('Sorry, this event is at full capacity.');
                        return;
                    }
                    event.attendees.push(userEmail);
                    rsvpBtn.textContent = 'Cancel RSVP';
                    alert('You have successfully RSVP\'d for this event!');
                }
                
                // Update the event in localStorage
                const updatedEvents = events.map(e => e.id === eventId ? event : e);
                localStorage.setItem('events', JSON.stringify(updatedEvents));
                
                // Update displayed attendee count and list
                document.getElementById('attendee-count').textContent = event.attendees.length;
                document.getElementById('spots-left').textContent = event.capacity - event.attendees.length;
                
                // Update attendees list
                attendeesList.innerHTML = '';
                if (event.attendees.length > 0) {
                    event.attendees.forEach(attendee => {
                        const li = document.createElement('li');
                        li.textContent = attendee;
                        attendeesList.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.textContent = 'No attendees yet';
                    attendeesList.appendChild(li);
                }
            });
            
            // Set RSVP button text based on current status
            if (userEmail && event.attendees && event.attendees.includes(userEmail)) {
                rsvpBtn.textContent = 'Cancel RSVP';
            }
            
            // Feedback button functionality
            document.getElementById('feedback-btn').addEventListener('click', function() {
                window.location.href = `feedback.html?eventId=${eventId}`;
            });
            
            // Edit Event button functionality
            document.getElementById('edit-event-btn').addEventListener('click', function() {
                if (userRole !== 'handler' || event.createdBy !== userEmail) {
                    alert('You do not have permission to edit this event');
                    return;
                }
                window.location.href = `edit-event.html?id=${eventId}`;
            });
            
            // Delete Event button functionality
            document.getElementById('delete-event-btn').addEventListener('click', function() {
                if (userRole !== 'handler' || event.createdBy !== userEmail) {
                    alert('You do not have permission to delete this event');
                    return;
                }
                
                if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                    const updatedEvents = events.filter(e => e.id !== eventId);
                    localStorage.setItem('events', JSON.stringify(updatedEvents));
                    alert('Event deleted successfully');
                    window.location.href = 'events.html';
                }
            });
        });
        
        // Helper functions
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
    </script>
</body>
</html>